!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("vue")):"function"==typeof define&&define.amd?define(["vue"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).VueWordCloud=e(t.Vue)}(this,(function(t){"use strict";var e=Array.isArray;function n(t){if(t){let e=typeof t;return"object"===e||"function"===e}return!1}function o(t){return"string"==typeof t}function a(t,e,n,o,a){let r=document.createElement("span");return r.style.font="1px serif",r.style.fontFamily=t,r.style.fontSize=`${e}px`,r.style.fontStyle=n,r.style.fontVariant=o,r.style.fontWeight=a,r.style.font}function r(t){return()=>t}return t.defineComponent({name:"VueWordCloud",props:{animationDuration:{type:Number,default:1e3},animationEasing:{type:String,default:"ease"},animationOverlap:{type:Number,default:1},enterAnimation:{type:[Object,String],default:r({opacity:0})},fontFamily:{type:String,default:"serif"},fontSizeRatio:{type:Number,default:0},fontStyle:{type:String,default:"normal"},fontVariant:{type:String,default:"normal"},fontWeight:{type:String,default:"normal"},leaveAnimation:{type:[Object,String],default:r({opacity:0})},spacing:{type:Number,default:0},words:{type:Array,default:function(){return[]}}},setup(r,{emit:l,slots:i}){let f=t.shallowRef(),u=t.shallowRef(0),s=t.shallowRef(0);t.onMounted((()=>{!function(e,{immediate:n=!1}={}){let o,a,r,l=!1,i=!1;a=()=>{try{e()}finally{i||r()}},r=()=>{o=requestAnimationFrame(a)};let f=n?a:r,u=()=>{i||(i=!0,cancelAnimationFrame(o))},s=()=>{l||(l=!0,u())};t.getCurrentInstance()&&t.onUnmounted(s),f()}((()=>{let t=f.value;t&&(u.value=t.offsetWidth,s.value=t.offsetHeight)}),{immediate:!0})}));let m=t.computed((()=>{let t=u.value,e=s.value;return t&&e?t/e:1}));t.computed((()=>{let t=r.animationOverlap;return t=Math.abs(t),t<1&&(t=1/t),t})),t.computed((()=>{let{animationDuration:t,enterAnimation:e,leaveAnimation:a}=r;if(n(e)&&n(a)){let n=e,o={},r=a;return Object.keys({...n,...r}).forEach((t=>{o[t]=null})),{css:!1,appear:!0,onBeforeEnter(t){Object.assign(t.style,n)},onEnter(e,n){Object.assign(e.style,o),setTimeout(n,t)},onLeave(e,n){Object.assign(e.style,r),setTimeout(n,t)}}}return o(e)&&o(a)?{duration:t,appear:!0,enterActiveClass:e,leaveActiveClass:a}:{}}));let p=t.computed((()=>{let t=r.fontSizeRatio;return t=Math.abs(t),t>1&&(t=1/t),t})),h=t.computed((()=>{let{fontFamily:t,fontStyle:l,fontVariant:i,fontWeight:f,words:u}=r,s="",m=1,p=new Map;return u.forEach((r=>{let u,{color:h,fontFamily:c=t,fontStyle:d=l,fontVariant:y=i,fontWeight:g=f,rotation:v,text:w=s,weight:b=m}=(()=>{if(o(r)){return{text:r}}if(e(r)){let[t,e]=r;return{text:t,weight:e}}return n(r)?r:{}})();{let t=a(c,1,d,y,g);for(u=JSON.stringify([w,t]);p.has(u);)u+="!"}p.set(u,{color:h,fontFamily:c,fontStyle:d,fontVariant:y,fontWeight:g,rotation:v,text:w,weight:b,word:r})})),p})),c=t.computed((()=>{let t=h.value,e=p.value,n=1/0,o=-1/0;t.forEach((({weight:t})=>{n=Math.min(n,t),o=Math.max(o,t)}));let a=n<o?e?1/e:n>0?o/n:o<0?n/o:1+o-n:1,r=new Map;return t.forEach((({weight:t},e)=>{let l=(f=1)+(t-(i=n))*(a-f)/(o-i);var i,f;r.set(e,l)})),r})),d=t.computed((()=>{let t=h.value,e=c.value,n=new Map;return t.forEach((({fontFamily:t,fontStyle:o,fontVariant:a,fontWeight:r,rotation:l,text:i},f)=>{let u=e.get(f);n.set(f,{fontFamily:t,fontSize:u,fontStyle:o,fontVariant:a,fontWeight:r,rotation:l,text:i})})),n})),y=t.shallowRef(new Map),g=t.shallowRef(0),v=t.shallowRef(0);t.watchEffect((async t=>{let e=d.value;m.value;let n=new AbortController;t((()=>{n.abort()}));let{signal:o}=n;var r;if(await(r=1e3,new Promise((t=>{setTimeout(t,r)}))),o.aborted)return;let l=0,i=0,f=0,u=0,s=new Map,p=document.createElement("canvas").getContext("2d");if(e.forEach((({fontFamily:t,fontSize:e,fontStyle:n,fontVariant:o,fontWeight:r,rotation:m=Math.random()*Math.PI,text:h},c)=>{let d,y,g=a(t,e,n,o,r);{p.font=g;let t=p.measureText(h).width+e,n=2*e,o=m,a=Math.abs(Math.cos(o)),r=Math.abs(Math.sin(o));d=t*a+n*r,y=t*r+n*a}let v=(w=l-d)+(i+d-w)*Math.random();var w;let b=((t,e)=>t+(e-t)*Math.random())(f-y,u+y);l=Math.min(l,v),i=Math.max(i,v+d),f=Math.min(f,b),u=Math.max(u,b+y),s.set(c,{left:v,rotation:m,top:b})})),o.aborted)return;let h=(l+i)/2,c=(f+u)/2,w=i-l,b=u-f;s.forEach((t=>{t.left-=h,t.top-=c})),o.aborted||(y.value=s,g.value=w,v.value=b)}));let w=t.computed((()=>{let t=g.value,e=v.value;if(t&&e){let n=u.value,o=s.value;return Math.min(n/t,o/e)}return 0})),b=t.computed((()=>{let t=h.value,e=new Map;return t.forEach((({color:t="Black"},n)=>{e.set(n,t)})),e})),M=t.computed((()=>{let t=c.value,e=y.value,n=w.value,o=new Map;return e.forEach((({left:e,top:a},r)=>{let l=t.get(r);l*=n,e*=n,a*=n,o.set(r,{fontSize:l,left:e,top:a})})),o})),S=t.computed((()=>{let t=h.value,e=b.value,n=M.value,o=y.value,r=[];return o.forEach((({rotation:o},l)=>{let{fontFamily:i,fontStyle:f,fontVariant:u,fontWeight:s,text:m,weight:p,word:h}=t.get(l),{fontSize:c,left:d,top:y}=n.get(l),g=e.get(l),v=a(i,c,f,u,s);r.push({word:h,key:l,text:m,weight:p,font:v,left:d,top:y,rotation:o,color:g})})),r}));return()=>{let e=S.value,n=(()=>{let t=i.word;return t||(({text:t})=>t)})();return t.h("div",{style:{height:"100%",position:"relative",width:"100%"},ref:f},[t.h("div",{style:{bottom:"50%",position:"absolute",right:"50%",transform:"translate(50%,50%)"}},e.map((({color:e,font:o,key:a,left:r,rotation:l,text:i,top:f,weight:u,word:s})=>t.h("div",{key:a,style:{color:e,font:o,left:`${r}px`,position:"absolute",top:`${f}px`,transform:`rotate(${l}rad)`,transformOrigin:"center",whiteSpace:"nowrap"}},n({text:i,weight:u,word:s})))))])}}})}));
